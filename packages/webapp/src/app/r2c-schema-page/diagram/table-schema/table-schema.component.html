<header>
  <span class="table-name">{{ data().url }}</span>
  <button matIconButton [matMenuTriggerFor]="tableMenu">
    <mat-icon>more_horiz</mat-icon>
  </button>
</header>
<ul>
  @for (col of data().tableSchema.columns; track col.name) {
    @let isPrimary = data().tableSchema.primaryKey.includes(col.name);
    @let foreignTable = foreignKeys()[col.name];
    <li
      [aria-label]="
        'Column ' +
        col.titles +
        (isPrimary ? ' (Primary Key)' : '') +
        (col.name in foreignKeys()
          ? ' (Foreign Key to ' + foreignTable + ')'
          : '')
      "
    >
      <span class="flex-container">
        <span
          class="name"
          [class.primary-key]="isPrimary"
          [class.foreign-key]="col.name in foreignKeys()"
          [attr.title]="
            col.name in foreignKeys() ? 'Foreign key to ' + foreignTable : null
          "
          >{{ col.titles }}</span
        >
        <span class="iri">{{ col.propertyUrl }}</span>
      </span>
      <button
        matIconButton
        [matMenuTriggerFor]="columnMenu"
        [matMenuTriggerData]="{ name: col.name, titles: col.titles }"
      >
        <mat-icon>more_horiz</mat-icon>
      </button>
    </li>
  }
</ul>

<mat-menu #tableMenu="matMenu">
  <button mat-menu-item (click)="renameTable.emit()">Rename table</button>
  <button mat-menu-item class="warn" (click)="deleteTable.emit()">
    Delete table
  </button>
</mat-menu>

<mat-menu #columnMenu="matMenu">
  <ng-template matMenuContent let-name="name" let-titles="titles">
    <button mat-menu-item (click)="renameCol.emit({ name, titles })">
      Rename column
    </button>
    <button
      mat-menu-item
      [matMenuTriggerFor]="moveMenu"
      [matMenuTriggerData]="{ name, titles }"
    >
      Move column to
    </button>
    <button
      mat-menu-item
      class="warn"
      (click)="deleteCol.emit({ name, titles })"
    >
      Delete column
    </button>
  </ng-template>
</mat-menu>

<mat-menu #moveMenu="matMenu">
  <ng-template matMenuContent let-name="name" let-titles="titles">
    @for (table of allTables(); track table.url) {
      @if (table.url !== data().url) {
        <button
          mat-menu-item
          (click)="
            moveCol.emit({
              column: name,
              toTable: table.url,
              columnTitles: titles,
            })
          "
        >
          {{ table.url }}
        </button>
      }
    }
  </ng-template>
</mat-menu>
